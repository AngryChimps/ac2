<?php
namespace {{namespace}}\base;

use AC\NormBundle\core\NormBaseObject;

class {{className}}Base extends NormBaseObject {

    /** @var  string */
    public static $primaryDatastoreName = '{{primaryDatastoreName}}';

    /** @var  string */
    public static $realm = '{{realm}}';

    /** @var  string */
    public static $tableName = '{{tableName}}';

    /** @var string[] */
    public static $fieldNames = array({{fieldNamesQuotedString}});

    /** @var string[] */
    public static $fieldTypes = array({{fieldTypesQuotedString}});

    /** @var  string[] */
    public static $propertyNames = array({{propertyNamesQuotedString}});

    /** @var  string[] */
    public static $primaryKeyFieldNames = array({{primaryKeyFieldNamesQuotedString}});

    /** @var  string[] */
    public static $primaryKeyPropertyNames = array({{primaryKeyPropertyNamesQuotedString}});

    /** @var  string[] */
    public static $autoIncrementFieldName = '{{autoIncrementFieldName}}';

    /** @var  string[] */
    public static $autoIncrementPropertyName = '{{autoIncrementPropertyName}}';

    /** @var  string[] */
    public static $autoGenerateFieldName = '{{autoGenerateFieldName}}';

    /** @var  string[] */
    public static $autoGeneratePropertyName = '{{autoGeneratePropertyName}}';

    /** @var bool */
    public static $hasPrimaryKey = {{hasPrimaryKey}};

    /** @var bool */
    public static $hasAutoIncrement = {{hasAutoIncrement}};

    {{#each enums}}
    {{#each values}}
    const {{name}} = {{value}};
    {{/each}}

    {{/each}}

    {{#each properties}}
    /** @var {{type}} */
    public ${{name}};

    {{/each}}

    public function __construct() {
        parent::__construct();

        {{#each defaults}}
        {{{statement}}}
        {{/each}}
    }

    {{#each foreignKeys}}
    /** @return {{propertyClassWithNamespace}} */
    public function get{{propertyName}}() {
        if($this->{{propertyName}} === null) {
            $this->load{{propertyName}}();
        }
        return $this->{{propertyName}};
    }

    {{/each}}

    {{#each foreignKeys}}
    protected function load{{propertyName}}() {
        parent::loadProperty('{{propertyName}}', '{{remoteTableName}}', '{{localPropertyIdFieldName}}');
    }

    {{/each}}

    {{#each reverseForeignKeys}}
    /** @return {{remotePropertyClassWithNamespace}} */
    public function get{{remotePropertyClass}}Collection() {
        if($this->{{remotePropertyClass}} === null) {
            $this->load{{remotePropertyClass}}{{collection}}();
        }
        return $this->{{remotePropertyClass}};
    }

    {{/each}}

    {{#each reverseForeignKeys}}
    protected function load{{remotePropertyClass}}Collection() {
        parent::loadPropertyCollection('{{remotePropertyClass}}', '{{localTableName}}', '{{localColumnName}}', '{{localPropertyIdFieldName}}');
    }

    {{/each}}

    /**
     * @param $pk
     * @return {{fullyQualifiedClassWithPrecedingBackslash}}
     */
    public static function getByPk($pk) {
        return parent::getByPk($pk);
    }

    /**
     * @param $where string The WHERE clause (excluding the word WHERE)
     * @param array $params The parameter count
     * @return {{fullyQualifiedClassWithPrecedingBackslash}}
     */
    public static function getByWhere($where, $params = array()) {
        return parent::getByWhere($where, $params);
    }

    /**
     * @param $sql string The complete sql statement with placeholders
     * @param array $params The parameter array to replace placeholders in the sql
     * @return {{fullyQualifiedClassWithPrecedingBackslash}}
     */
    public static function getBySql($sql, $params = array()) {
        return parent::getBySql($sql, $params);
    }

}